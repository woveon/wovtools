#!/usr/bin/env bash

DOECHO=1
DOFORCE=0
FOLD=80
BLOCK=0

# ---------------------------------------------------------------------
# Import Env
# ---------------------------------------------------------------------
pushargs=( "$@" )
set ""
. wov-env
. wov-ns-check
set -- "${pushargs[@]}"

wov-build -e

# Check local code is checked in and pushed
wov-git-check -v ${WOV_BASEDIR}
R1=$?
wov-git-check -v ${WOV_BASEDIR}/wovtools/secrets
R2=$?
if [ "$R1" != "0" ] || [ "$R2" != "0" ]; then exit 1; fi


# ---------------------------------------------------------------------
# ---------------------------------------------------------------------
function fDisplayOptions()
{
  cat <<EOF | fold -w ${FOLD} -s


usage: `basename $0` [options]

Macro command that pushes containers, then env. It uses:
   wov-push-containers
   wov-push-env

  -h : this help
  -q/-v : quiet/verbose

EOF
}

METAARGS=""

# ---------------------------------------------------------------------
# Handle Params
# ---------------------------------------------------------------------
while [[ $1 =~ ^- ]]; do

  if [ "$1" == "-q" ]; then
    shift
    DOECHO=0
    METAARGS="${METAARGS} -q "

  elif [ "$1" == "-v" ]; then
    shift
    DOECHO=2
    METAARGS="${METAARGS} -v "


  elif [ "$1" == "-h" ] || [ "$1" == "--help" ]; then
    fDisplayOptions
    exit 0

  else
    echo
    echo "***ERROR: unknown option '$1'."
    echo
    fDisplayOptions
    exit 1
  fi
done


echo "  ... wov-push-containers ${METAARGS}"
wov-push-containers ${METAARGS}
echo "  ... wov-push-env ${METAARGS}"
wov-push-env ${METAARGS}
