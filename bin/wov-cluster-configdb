#!/usr/bin/env bash 

# Load vars
eval $(wov-env --provider --conf)


cat <<EOF


(WARNING!!!) This script is largely a bunch of scripts that worked at one time and needs to be tested and fixed.

This details what you need to do, as it does not do it for you.

  - make sure you ran 'wov-cluster config dbnet', as it would have created the peering connections
    - it might have created the private subnets too, so check to make sure

  - in the default VPC,
    - create 2 private subnets 'private-subnet-for-rds-[cd]' with small CIDR blocks, in two separate zones
      ex. 172.31.196.0/28 in us-east-1c and 172.31.196.16/28 in us-east-1d
    - ??? These should be peered over to the cluster's VPC

  - in RDS - create a database 'subnet group' with both those VPCs, this is where RDS instances will be

  - in RDS, create an RDS database instance
    - create a database using the database subnet group just created
    - **NOTE: make sure 'Public accessibility' is set to 'no'**  - or else it will not place the database inside the dbsng


SETTINGS:
Use these settings to create a database in the default VPC, with a peered connection over to your cluster's vpc.

    Name: ${WOV_CLUSTER}-${WOV_alywandb_instancename}db-${WOV_STAGE}

            Database : ${WOV_alywandb_type}
       VPC (Default) : ${AWS_VPC}
            username : ${WOV_alywandb_username}
            password : XXXXXXXXXXXX
            database : ${WOV_alywandb_database}
    postgres version : ${WOV_alywandb_version}
         DB Instance : ${WOV_alywandb_instance_class}
          DB Storage : ${WOV_alywandb_instance_storage} GB, SSD
        Subnet group : ${WOV_CLUSTER}-dsng
   Availability zone : ${AWS_ZONES[0]} : showing us-east-1d
  VPC security group : FIX used create new

---fixed values
   Public Accessible : false
 disable monitoring
 log postgresql log, upgrade log
 auto minor version upgrade enabled
 maint window, no pref
 backup 7 days no pref
 enable encryption, master key aws/rds
 IAM DB Authentication - disabled


EOF

